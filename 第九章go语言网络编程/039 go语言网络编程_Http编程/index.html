



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="go语言的学习笔记">
      
      
        <link rel="canonical" href="https://zangzhenhua1996.github.io/go/第九章go语言网络编程/039 go语言网络编程_Http编程/">
      
      
        <meta name="author" content="臧珍华">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Http编程 - 臧珍华的博客</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#757575">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="grey" data-md-color-accent="pink">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#http" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://zangzhenhua1996.github.io/go/" title="臧珍华的博客" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              臧珍华的博客
            </span>
            <span class="md-header-nav__topic">
              
                Http编程
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://www.jianshu.com/u/21b46dcb7c44" title="前往 Github 仓库" class="md-source" data-md-source="">
  
  <div class="md-source__repository">
    I love AnFei
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        介绍
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../第一章go语言开发环境配置/001 go语言开发环境配置/" class="md-tabs__link">
          安装
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../第二章go语言基本语法结构/002 go语言第一个例子/" class="md-tabs__link">
          基础语法
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../第三章go语言工程管理/013 go语言工作区/" class="md-tabs__link">
          工程管理
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../第四章go语言复合类型/016 go语言复合类型分类/" class="md-tabs__link">
          复合类型
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../第五章go语言面向对象编程/023 go语言面向对象编程概述/" class="md-tabs__link">
          面向对象编程
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../第六章go语言异常处理/027 go语言异常处理_error接口/" class="md-tabs__link">
          异常处理
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../第七章go语言文本文件处理/030 go语言文本文件处理_字符串操作/" class="md-tabs__link">
          文本文件处理
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../第八章go语言并发编程/034 go语言并发编程_概述/" class="md-tabs__link">
          并发编程
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../037 go语言网络编程_网络概述/" class="md-tabs__link md-tabs__link--active">
          网络编程
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://zangzhenhua1996.github.io/go/" title="臧珍华的博客" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    臧珍华的博客
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://www.jianshu.com/u/21b46dcb7c44" title="前往 Github 仓库" class="md-source" data-md-source="">
  
  <div class="md-source__repository">
    I love AnFei
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="介绍" class="md-nav__link">
      介绍
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      安装
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        安装
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../第一章go语言开发环境配置/001 go语言开发环境配置/" title="本地环境搭建" class="md-nav__link">
      本地环境搭建
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      基础语法
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        基础语法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/002 go语言第一个例子/" title="第一个例子" class="md-nav__link">
      第一个例子
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/003 go语言结构/" title="go语言结构" class="md-nav__link">
      go语言结构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/004 go语言基础语法/" title="go语言基础语法" class="md-nav__link">
      go语言基础语法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/005 go变量定义/" title="go变量定义" class="md-nav__link">
      go变量定义
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/006 go内建变量类型/" title="go内建变量类型" class="md-nav__link">
      go内建变量类型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/007 go常量与枚举/" title="go常量与枚举" class="md-nav__link">
      go常量与枚举
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/008 go语言运算符/" title="go语言运算符" class="md-nav__link">
      go语言运算符
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/009 go语言条件语句/" title="go语言条件语句" class="md-nav__link">
      go语言条件语句
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/010 go语言循环语句/" title="go语言循环语句" class="md-nav__link">
      go语言循环语句
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/011 go语言函数/" title="go语言函数" class="md-nav__link">
      go语言函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第二章go语言基本语法结构/012 go语言变量作用域/" title="go语言变量作用域" class="md-nav__link">
      go语言变量作用域
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      工程管理
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        工程管理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../第三章go语言工程管理/013 go语言工作区/" title="工作区" class="md-nav__link">
      工作区
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第三章go语言工程管理/014 go语言的包/" title="包" class="md-nav__link">
      包
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第三章go语言工程管理/015 go语言工程配置编译/" title="工程配置编译" class="md-nav__link">
      工程配置编译
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      复合类型
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        复合类型
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../第四章go语言复合类型/016 go语言复合类型分类/" title="分类" class="md-nav__link">
      分类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第四章go语言复合类型/017 go语言复合类型指针/" title="指针" class="md-nav__link">
      指针
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第四章go语言复合类型/018 go语言复合类型数组/" title="数组" class="md-nav__link">
      数组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第四章go语言复合类型/019 go语言复合类型切片(slice)/" title="切片" class="md-nav__link">
      切片
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第四章go语言复合类型/020 go语言复合类型map/" title="map" class="md-nav__link">
      map
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第四章go语言复合类型/021 go 语言结构体/" title="结构体" class="md-nav__link">
      结构体
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第四章go语言复合类型/022 go语言范围range/" title="范围range" class="md-nav__link">
      范围range
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      面向对象编程
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        面向对象编程
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../第五章go语言面向对象编程/023 go语言面向对象编程概述/" title="概述" class="md-nav__link">
      概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第五章go语言面向对象编程/024 go语言面向对象匿名组合/" title="匿名组合" class="md-nav__link">
      匿名组合
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第五章go语言面向对象编程/025 go语言面向对象_方法/" title="方法" class="md-nav__link">
      方法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第五章go语言面向对象编程/026 go语言面向对象_接口/" title="接口" class="md-nav__link">
      接口
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      异常处理
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        异常处理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../第六章go语言异常处理/027 go语言异常处理_error接口/" title="error接口" class="md-nav__link">
      error接口
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第六章go语言异常处理/028 go语言异常处理_panic/" title="panic" class="md-nav__link">
      panic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第六章go语言异常处理/029 go语言异常处理_recover/" title="recover" class="md-nav__link">
      recover
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      文本文件处理
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        文本文件处理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../第七章go语言文本文件处理/030 go语言文本文件处理_字符串操作/" title="字符串操作" class="md-nav__link">
      字符串操作
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第七章go语言文本文件处理/031 go语言文本文件处理_正则表达式/" title="正则表达式" class="md-nav__link">
      正则表达式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第七章go语言文本文件处理/032 go语言文本文件处理_JSON处理/" title="JSON处理" class="md-nav__link">
      JSON处理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第七章go语言文本文件处理/033 go语言文本文件处理_文本操作/" title="文本操作" class="md-nav__link">
      文本操作
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      并发编程
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        并发编程
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../第八章go语言并发编程/034 go语言并发编程_概述/" title="概述" class="md-nav__link">
      概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第八章go语言并发编程/035 go语言并发编程_goroutine/" title="goroutine" class="md-nav__link">
      goroutine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../第八章go语言并发编程/036 go语言并发编程_channel/" title="channel" class="md-nav__link">
      channel
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" checked>
    
    <label class="md-nav__link" for="nav-10">
      网络编程
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        网络编程
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../037 go语言网络编程_网络概述/" title="概述" class="md-nav__link">
      概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../038 go语言网络编程_Socket编程/" title="Socket编程" class="md-nav__link">
      Socket编程
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Http编程
      </label>
    
    <a href="./" title="Http编程" class="md-nav__link md-nav__link--active">
      Http编程
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    概述
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    Web工作方式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http_1" class="md-nav__link">
    HTTP协议
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    地址（URL）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http_2" class="md-nav__link">
    HTTP报文浅析
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    请求报文格式
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1) 测试代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2) 请求报文格式说明
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    响应报文格式
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    1) 测试代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    2) 响应报文格式说明
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http_3" class="md-nav__link">
    HTTP编程
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http_4" class="md-nav__link">
    HTTP服务端
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    示例代码：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http_5" class="md-nav__link">
    HTTP客户端
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    访问百度1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    访问百度2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    百度贴吧爬虫
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    并发百度贴吧网络爬虫
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    段子爬虫
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    概述
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    Web工作方式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http_1" class="md-nav__link">
    HTTP协议
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    地址（URL）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http_2" class="md-nav__link">
    HTTP报文浅析
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    请求报文格式
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1) 测试代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2) 请求报文格式说明
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    响应报文格式
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    1) 测试代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    2) 响应报文格式说明
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http_3" class="md-nav__link">
    HTTP编程
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http_4" class="md-nav__link">
    HTTP服务端
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    示例代码：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http_5" class="md-nav__link">
    HTTP客户端
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    访问百度1:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    访问百度2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    百度贴吧爬虫
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    并发百度贴吧网络爬虫
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    段子爬虫
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="http">HTTP编程<a class="headerlink" href="#http" title="Permanent link">&para;</a></h1>
<h2 id="_1">概述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="web">Web工作方式<a class="headerlink" href="#web" title="Permanent link">&para;</a></h3>
<p>我们平时浏览网页的时候,会打开浏览器，输入网址后按下回车键，然后就会显示出你想要浏览的内容。在这个看似简单的用户行为背后，到底隐藏了些什么呢？</p>
<p>对于普通的上网过程，系统其实是这样做的：浏览器本身是一个客户端，当你输入URL的时候，首先浏览器会去请求DNS服务器，通过DNS获取相应的域名对应的IP，然后通过IP地址找到IP对应的服务器后，要求建立TCP连接，等浏览器发送完HTTP Request（请求）包后，服务器接收到请求包之后才开始处理请求包，服务器调用自身服务，返回HTTP Response（响应）包；客户端收到来自服务器的响应后开始渲染这个Response包里的主体（body），等收到全部的内容随后断开与该服务器之间的TCP连接。</p>
<p><img alt="img" src="../039 go语言网络编程_Http编程.image/clip_image002.jpg" /></p>
<p>一个Web服务器也被称为HTTP服务器，它通过HTTP协议与客户端通信。这个客户端通常指的是Web浏览器(其实手机端客户端内部也是浏览器实现的)。</p>
<p><strong>Web服务器的工作原理可以简单地归纳为：</strong></p>
<ul>
<li>
<p>客户机通过TCP/IP协议建立到服务器的TCP连接</p>
</li>
<li>
<p>客户端向服务器发送HTTP协议请求包，请求服务器里的资源文档</p>
</li>
<li>
<p>服务器向客户机发送HTTP协议应答包，如果请求的资源包含有动态语言的内容，那么服务器会调用动态语言的解释引擎负责处理“动态内容”，并将处理得到的数据返回给客户端</p>
</li>
<li>
<p>客户机与服务器断开。由客户端解释HTML文档，在客户端屏幕上渲染图形结果</p>
</li>
</ul>
<h3 id="http_1">HTTP协议<a class="headerlink" href="#http_1" title="Permanent link">&para;</a></h3>
<p>超文本传输协议(HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议，它详细规定了浏览器和万维网服务器之间互相通信的规则，通过因特网传送万维网文档的数据传送协议。</p>
<p>HTTP协议通常承载于TCP协议之上，有时也承载于TLS或SSL协议层之上，这个时候，就成了我们常说的HTTPS。如下图所示：</p>
<p><img alt="图片4" src="../039 go语言网络编程_Http编程.image/clip_image004.jpg" /></p>
<h3 id="url">地址（URL）<a class="headerlink" href="#url" title="Permanent link">&para;</a></h3>
<p>URL全称为Unique Resource Location，用来表示网络资源，可以理解为网络文件路径。</p>
<p>URL的格式如下：</p>
<p>http://host[":"port][abs_path]</p>
<p><a href="http://192.168.31.1/html/index">http://192.168.31.1/html/index</a></p>
<p>URL的长度有限制，不同的服务器的限制值不太相同，但是不能无限长。</p>
<h2 id="http_2">HTTP报文浅析<a class="headerlink" href="#http_2" title="Permanent link">&para;</a></h2>
<h3 id="_2">请求报文格式<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<h4 id="1">1) 测试代码<a class="headerlink" href="#1" title="Permanent link">&para;</a></h4>
<p>服务器测试代码：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;net&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//创建、监听socket</span>
    <span class="nx">listenner</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span> <span class="s">&quot;127.0.0.1:8001&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="c1">//log.Fatal()会产生panic</span>
    <span class="p">}</span>

    <span class="k">defer</span> <span class="nx">listenner</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">listenner</span><span class="p">.</span><span class="nx">Accept</span><span class="p">()</span> <span class="c1">//阻塞等待客户端连接</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="k">defer</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span> <span class="c1">//此函数结束时，关闭连接套接字</span>

    <span class="c1">//conn.RemoteAddr().String()：连接客服端的网络地址</span>
    <span class="nx">ipAddr</span> <span class="o">:=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">().</span><span class="nx">String</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ipAddr</span><span class="p">,</span> <span class="s">&quot;连接成功&quot;</span><span class="p">)</span>

    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span> <span class="c1">//缓冲区，用于接收客户端发送的数据</span>

    <span class="c1">//阻塞等待用户发送的数据</span>
    <span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span> <span class="c1">//n代码接收数据的长度</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">//切片截取，只截取有效数据</span>
    <span class="nx">result</span> <span class="o">:=</span> <span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">]</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;接收到数据来自[%s]==&gt;:\n%s\n&quot;</span><span class="p">,</span> <span class="nx">ipAddr</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">result</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>浏览器输入url地址：  <code>127.0.0.1:8001/go</code></p>
<p><img alt="2018-01-18_145939" src="../039 go语言网络编程_Http编程.image/clip_image006.png" /></p>
<p>服务器端运行打印结果如下：</p>
<p><img alt="2018-01-18_145856" src="../039 go语言网络编程_Http编程.image/clip_image008.jpg" /></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">50904</span> <span class="nx">连接成功</span>
<span class="nx">接收到数据来自</span><span class="p">[</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">50904</span><span class="p">]</span><span class="o">==</span><span class="p">&gt;:</span>
<span class="nx">GET</span> <span class="o">/</span><span class="k">go</span> <span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span>  
<span class="nx">Host</span><span class="p">:</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8001</span>
<span class="nx">Connection</span><span class="p">:</span> <span class="nx">keep</span><span class="o">-</span><span class="nx">alive</span>
<span class="nx">Cache</span><span class="o">-</span><span class="nx">Control</span><span class="p">:</span> <span class="nx">max</span><span class="o">-</span><span class="nx">age</span><span class="p">=</span><span class="mi">0</span>
<span class="nx">Upgrade</span><span class="o">-</span><span class="nx">Insecure</span><span class="o">-</span><span class="nx">Requests</span><span class="p">:</span> <span class="mi">1</span>
<span class="nx">User</span><span class="o">-</span><span class="nx">Agent</span><span class="p">:</span> <span class="nx">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="nx">Windows</span> <span class="nx">NT</span> <span class="mf">10.0</span><span class="p">;</span> <span class="nx">Win64</span><span class="p">;</span> <span class="nx">x64</span><span class="p">)</span> <span class="nx">AppleWebKit</span><span class="o">/</span><span class="mf">537.36</span> <span class="p">(</span><span class="nx">KHTML</span><span class="p">,</span> <span class="nx">like</span> <span class="nx">Gecko</span><span class="p">)</span> <span class="nx">Chrome</span><span class="o">/</span><span class="mf">80.0.3987.53</span> <span class="nx">Safari</span><span class="o">/</span><span class="mf">537.36</span> <span class="nx">Edg</span><span class="o">/</span><span class="mf">80.0.361.33</span>
<span class="nx">Sec</span><span class="o">-</span><span class="nx">Fetch</span><span class="o">-</span><span class="nx">Dest</span><span class="p">:</span> <span class="nx">document</span>
<span class="nx">Accept</span><span class="p">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xhtml</span><span class="o">+</span><span class="nx">xml</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xml</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.9</span><span class="p">,</span><span class="nx">image</span><span class="o">/</span><span class="nx">webp</span><span class="p">,</span><span class="nx">image</span><span class="o">/</span><span class="nx">apng</span><span class="p">,</span><span class="o">*/*</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.8</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">signed</span><span class="o">-</span><span class="nx">exchange</span><span class="p">;</span><span class="nx">v</span><span class="p">=</span><span class="nx">b3</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.9</span>
<span class="nx">Sec</span><span class="o">-</span><span class="nx">Fetch</span><span class="o">-</span><span class="nx">Site</span><span class="p">:</span> <span class="nx">cross</span><span class="o">-</span><span class="nx">site</span>
<span class="nx">Sec</span><span class="o">-</span><span class="nx">Fetch</span><span class="o">-</span><span class="nx">Mode</span><span class="p">:</span> <span class="nx">navigate</span>
<span class="nx">Sec</span><span class="o">-</span><span class="nx">Fetch</span><span class="o">-</span><span class="nx">User</span><span class="p">:</span> <span class="err">?</span><span class="mi">1</span>
<span class="nx">Accept</span><span class="o">-</span><span class="nx">Encoding</span><span class="p">:</span> <span class="nx">gzip</span><span class="p">,</span> <span class="nx">deflate</span><span class="p">,</span> <span class="nx">br</span>
<span class="nx">Accept</span><span class="o">-</span><span class="nx">Language</span><span class="p">:</span> <span class="nx">en</span><span class="o">-</span><span class="nx">US</span><span class="p">,</span><span class="nx">en</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.9</span><span class="p">,</span><span class="nx">zh</span><span class="o">-</span><span class="nx">CN</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.8</span><span class="p">,</span><span class="nx">zh</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.7</span>



<span class="nx">Process</span> <span class="nx">finished</span> <span class="nx">with</span> <span class="nx">exit</span> <span class="nx">code</span> <span class="mi">0</span>
</pre></div>
</td></tr></table>

<h4 id="2">2) 请求报文格式说明<a class="headerlink" href="#2" title="Permanent link">&para;</a></h4>
<p><mark>HTTP 请求报文由请求行、请求头部、空行、请求包体4个部分组成，如下图所示：</mark></p>
<p><img alt="请求" src="../039 go语言网络编程_Http编程.image/clip_image010.jpg" /></p>
<ol>
<li>请求行</li>
</ol>
<p>请求行 由方法字段、URL 字段 和HTTP 协议版本字段 3 个部分组成，他们之间使用空格隔开。常用的 HTTP 请求方法有 GET、POST。</p>
<p>GET：</p>
<ul>
<li>
<p>当客户端要从服务器中读取某个资源时，使用GET 方法。GET 方法要求服务器将URL 定位的资源放在响应报文的数据部分，回送给客户端，即向服务器请求某个资源。</p>
</li>
<li>
<p>使用GET方法时，请求参数和对应的值附加在 URL 后面，利用一个问号(“?”)代表URL 的结尾与请求参数的开始，传递参数长度受限制，因此GET方法不适合用于上传数据。</p>
</li>
<li>
<p>通过GET方法来获取网页时，参数会显示在浏览器地址栏上，因此保密性很差。</p>
</li>
</ul>
<p>POST：</p>
<ul>
<li>
<p>当客户端给服务器提供信息较多时可以使用POST 方法，POST 方法向服务器提交数据，比如完成表单数据的提交，将数据提交给服务器处理。</p>
</li>
<li>
<p>GET 一般用于<code>获取/查询资源信息</code>，POST 会附带用户数据，一般用于更新资源信息。POST 方法将请求参数封装在HTTP 请求数据中，而且长度没有限制，因为POST携带的数据，在HTTP的请求正文中，<mark>以名称/值的形式出现，可以传输大量数据。</mark></p>
</li>
<li>
<p>请求头部</p>
</li>
</ul>
<p>请求头部为请求报文添加了一些附加信息，<code>由“名/值”对组成，每行一对，名和值之间使用冒号分隔。</code>(字典的形式)</p>
<p>请求头部通知服务器有关于客户端请求的信息，典型的请求头有：</p>
<table>
<thead>
<tr>
<th><strong>请求头</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>User-Agent</td>
<td>请求的浏览器类型</td>
</tr>
<tr>
<td>Accept</td>
<td>客户端可识别的响应内容类型列表，星号“ * ”用于按范围将类型分组，用“ <em>/</em> ”指示可接受全部类型，用“ type/* ”指示可接受 type 类型的所有子类型</td>
</tr>
<tr>
<td>Accept-Language</td>
<td>客户端可接受的自然语言</td>
</tr>
<tr>
<td>Accept-Encoding</td>
<td>客户端可接受的编码压缩格式</td>
</tr>
<tr>
<td>Accept-Charset</td>
<td>可接受的应答的字符集</td>
</tr>
<tr>
<td>Host</td>
<td>请求的主机名，允许多个域名同处一个IP 地址，即虚拟主机</td>
</tr>
<tr>
<td>connection</td>
<td>连接方式(close或keepalive)</td>
</tr>
<tr>
<td>Cookie</td>
<td>存储于客户端扩展字段，向同一域名的服务端发送属于该域的cookie</td>
</tr>
</tbody>
</table>
<ol>
<li>空行</li>
</ol>
<p>最后一个请求头之后是一个空行，发送回车符和换行符，通知服务器以下不再有请求头。</p>
<ol>
<li>请求包体</li>
</ol>
<p>请求包体不在GET方法中使用，而是POST方法中使用。</p>
<p><mark>POST方法适用于需要客户填写表单的场合。与请求包体相关的最常使用的是包体类型Content-Type和包体长度Content-Length。</mark></p>
<h3 id="_3">响应报文格式<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<h4 id="1_1">1) 测试代码<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h4>
<p>服务器示例代码：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="c1">//服务端编写的业务逻辑处理程序</span>
<span class="kd">func</span> <span class="nx">myHandler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;hello world&quot;</span><span class="p">)</span>  <span class="c1">//客户端访问返回结果</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/go&quot;</span><span class="p">,</span> <span class="nx">myHandler</span><span class="p">)</span>

    <span class="c1">//在指定的地址进行监听，开启一个HTTP</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;127.0.0.1:8001&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>启动服务器程序：</p>
<p><img alt="image-20200122223311937" src="../039 go语言网络编程_Http编程.image/image-20200122223311937.png" /></p>
<p>使用浏览器访问测试:</p>
<p><img alt="image-20200122223352186" src="../039 go语言网络编程_Http编程.image/image-20200122223352186.png" /></p>
<p>客户端测试示例代码：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;net&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//客户端主动连接服务器</span>
    <span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Dial</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span> <span class="s">&quot;127.0.0.1:8001&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="c1">//log.Fatal()会产生panic</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="k">defer</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span> <span class="c1">//关闭</span>

    <span class="nx">requestHeader</span> <span class="o">:=</span> <span class="s">&quot;GET /go HTTP/1.1\r\nAccept: image/gif, image/jpeg, image/pjpeg, application/x-ms-application, application/xaml+xml, application/x-ms-xbap, */*\r\nAccept-Language: zh-Hans-CN,zh-Hans;q=0.8,en-US;q=0.5,en;q=0.3\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729)\r\nAccept-Encoding: gzip, deflate\r\nHost: 127.0.0.1:8000\r\nConnection: Keep-Alive\r\n\r\n&quot;</span>

    <span class="c1">//先发送请求包</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">requestHeader</span><span class="p">))</span>

    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span> <span class="c1">//缓冲区</span>

    <span class="c1">//阻塞等待服务器回复的数据</span>
    <span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span> <span class="c1">//n代码接收数据的长度</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="c1">//切片截取，只截取有效数据</span>
    <span class="nx">result</span> <span class="o">:=</span> <span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">]</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;接收到数据[%d]:\n%s\n&quot;</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">result</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>启动程序，测试http的成功响应报文：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">接收到数据</span><span class="p">[</span><span class="mi">129</span><span class="p">]:</span>
<span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="nx">OK</span>
<span class="nx">Date</span><span class="p">:</span> <span class="nx">Thu</span><span class="p">,</span> <span class="mi">23</span> <span class="nx">Jan</span> <span class="mi">2020</span> <span class="mo">01</span><span class="p">:</span><span class="mo">05</span><span class="p">:</span><span class="mi">15</span> <span class="nx">GMT</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="p">:</span> <span class="mi">12</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">plain</span><span class="p">;</span> <span class="nx">charset</span><span class="p">=</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span>

<span class="nx">hello</span> <span class="nx">world</span>
</pre></div>
</td></tr></table>

<p><img alt="image-20200123090640514" src="../039 go语言网络编程_Http编程.image/image-20200123090640514.png" /></p>
<p>启动程序，测试http的失败响应报文：(将请求的go 换成别的xxx 就会请求失败)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">接收到数据</span><span class="p">[</span><span class="mi">176</span><span class="p">]:</span>
<span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">404</span> <span class="nx">Not</span> <span class="nx">Found</span>   <span class="c1">//状态码反应是否成功</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">plain</span><span class="p">;</span> <span class="nx">charset</span><span class="p">=</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span>
<span class="nx">X</span><span class="o">-</span><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">-</span><span class="nx">Options</span><span class="p">:</span> <span class="nx">nosniff</span>
<span class="nx">Date</span><span class="p">:</span> <span class="nx">Thu</span><span class="p">,</span> <span class="mi">23</span> <span class="nx">Jan</span> <span class="mi">2020</span> <span class="mo">01</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mo">02</span> <span class="nx">GMT</span>
<span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="p">:</span> <span class="mi">19</span>

<span class="mi">404</span> <span class="nx">page</span> <span class="nx">not</span> <span class="nx">found</span>
</pre></div>
</td></tr></table>

<h4 id="2_1">2) 响应报文格式说明<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h4>
<p>HTTP 响应报文由状态行、响应头部、空行、响应包体4个部分组成，如下图所示：</p>
<p><img alt="响应" src="../039 go语言网络编程_Http编程.image/clip_image018.png" /></p>
<ol>
<li>状态行</li>
</ol>
<p>状态行由 HTTP 协议版本字段、状态码和状态码的描述文本3个部分组成，他们之间使用空格隔开。</p>
<ul>
<li>状态码：</li>
</ul>
<p>状态码由三位数字组成，第一位数字表示响应的类型，常用的状态码有五大类如下所示：</p>
<table>
<thead>
<tr>
<th><strong>状态码</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>1xx</td>
<td>表示服务器已接收了客户端请求，客户端可继续发送请求</td>
</tr>
<tr>
<td>2xx</td>
<td>表示服务器已成功接收到请求并进行处理</td>
</tr>
<tr>
<td>3xx</td>
<td>表示服务器要求客户端重定向</td>
</tr>
<tr>
<td>4xx</td>
<td>表示客户端的请求有非法内容</td>
</tr>
<tr>
<td>5xx</td>
<td>表示服务器未能正常处理客户端的请求而出现意外错误</td>
</tr>
</tbody>
</table>
<ul>
<li>常见的状态码举例：</li>
</ul>
<table>
<thead>
<tr>
<th><strong>状态码</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>200 OK</td>
<td>客户端请求成功</td>
</tr>
<tr>
<td>400 Bad Request</td>
<td>请求报文有语法错误</td>
</tr>
<tr>
<td>401 Unauthorized</td>
<td>未授权</td>
</tr>
<tr>
<td>403 Forbidden</td>
<td>服务器拒绝服务</td>
</tr>
<tr>
<td>404 Not Found</td>
<td>请求的资源不存在</td>
</tr>
<tr>
<td>500 Internal Server  Error</td>
<td>服务器内部错误</td>
</tr>
<tr>
<td>503 Server Unavailable</td>
<td>服务器临时不能处理客户端请求(稍后可能可以)</td>
</tr>
</tbody>
</table>
<ol>
<li>响应头部</li>
</ol>
<p>响应头可能包括：</p>
<table>
<thead>
<tr>
<th><strong>响应头</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Location</td>
<td>Location响应报头域用于重定向接受者到一个新的位置</td>
</tr>
<tr>
<td>Server</td>
<td>Server 响应报头域包含了服务器用来处理请求的软件信息及其版本</td>
</tr>
<tr>
<td>Vary</td>
<td>指示不可缓存的请求头列表</td>
</tr>
<tr>
<td>Connection</td>
<td>连接方式</td>
</tr>
</tbody>
</table>
<ol>
<li>空行</li>
</ol>
<p>最后一个响应头部之后是一个空行，发送回车符和换行符，通知服务器以下不再有响应头部。</p>
<ol>
<li>响应包体</li>
</ol>
<p>服务器返回给客户端的文本信息。</p>
<h2 id="http_3">HTTP编程<a class="headerlink" href="#http_3" title="Permanent link">&para;</a></h2>
<p>Go语言标准库内建提供了net/http包，涵盖了HTTP客户端和服务端的具体实现。使用</p>
<p>net/http包，我们可以很方便地编写HTTP客户端或服务端的程序。  </p>
<p>这个包的官方文档: <a href="https://studygolang.com/pkgdoc">https://studygolang.com/pkgdoc</a></p>
<h3 id="http_4">HTTP服务端<a class="headerlink" href="#http_4" title="Permanent link">&para;</a></h3>
<h4 id="_4">示例代码：<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="c1">//服务端编写的业务逻辑处理程序</span>
<span class="c1">//hander函数： 具有func(w http.ResponseWriter, r *http.Requests)签名的函数</span>
<span class="c1">//w, 给客户端回复数据</span>
<span class="c1">//r, 读取客户端发送的数据</span>
<span class="kd">func</span> <span class="nx">HandConn</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 从客户端获取数据</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;r.Method = &quot;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="p">)</span>   <span class="c1">//请求方法</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;r.URL = &quot;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;r.Header = &quot;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;r.Body = &quot;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span> 

    <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;hello go&quot;</span><span class="p">))</span> <span class="c1">//给客户端回复数据</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//注册处理函数，用户连接，自动调用指定的处理函数</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/go&quot;</span><span class="p">,</span> <span class="nx">HandConn</span><span class="p">)</span>   <span class="c1">//  &quot;/&quot;其实就是后面需要处理的请求,不写就是直接输入ip地址</span>

    <span class="c1">//监听绑定</span>
    <span class="c1">//该方法用于在指定的 TCP 网络地址 addr 进行监听，然后调用服务端处理程序来处理传入的连接请求。</span>
    <span class="c1">//该方法有两个参数：第一个参数 addr 即监听地址；第二个参数表示服务端处理程序，通常为空</span>
    <span class="c1">//第二个参数为空意味着服务端调用 http.DefaultServeMux 进行处理</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8001&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>  
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>浏览器输入url地址：</p>
<p><img alt="image-20200123094643346" src="../039 go语言网络编程_Http编程.image/image-20200123094643346.png" /></p>
<p>服务器运行结果：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span> <span class="p">=</span>  <span class="nx">GET</span>
<span class="nx">r</span><span class="p">.</span><span class="nx">URL</span> <span class="p">=</span>  <span class="o">/</span><span class="k">go</span>
<span class="nx">r</span><span class="p">.</span><span class="nx">Header</span> <span class="p">=</span>  <span class="kd">map</span><span class="p">[</span><span class="nx">Accept</span><span class="p">:[</span><span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xhtml</span><span class="o">+</span><span class="nx">xml</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xml</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.9</span><span class="p">,</span><span class="nx">image</span><span class="o">/</span><span class="nx">webp</span><span class="p">,</span><span class="nx">image</span><span class="o">/</span><span class="nx">apng</span><span class="p">,</span><span class="o">*/*</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.8</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">signed</span><span class="o">-</span><span class="nx">exchange</span><span class="p">;</span><span class="nx">v</span><span class="p">=</span><span class="nx">b3</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.9</span><span class="p">]</span> <span class="nx">Accept</span><span class="o">-</span><span class="nx">Encoding</span><span class="p">:[</span><span class="nx">gzip</span><span class="p">,</span> <span class="nx">deflate</span><span class="p">,</span> <span class="nx">br</span><span class="p">]</span> <span class="nx">Accept</span><span class="o">-</span><span class="nx">Language</span><span class="p">:[</span><span class="nx">en</span><span class="o">-</span><span class="nx">US</span><span class="p">,</span><span class="nx">en</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.9</span><span class="p">,</span><span class="nx">zh</span><span class="o">-</span><span class="nx">CN</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.8</span><span class="p">,</span><span class="nx">zh</span><span class="p">;</span><span class="nx">q</span><span class="p">=</span><span class="mf">0.7</span><span class="p">]</span> <span class="nx">Cache</span><span class="o">-</span><span class="nx">Control</span><span class="p">:[</span><span class="nx">max</span><span class="o">-</span><span class="nx">age</span><span class="p">=</span><span class="mi">0</span><span class="p">]</span> <span class="nx">Connection</span><span class="p">:[</span><span class="nx">keep</span><span class="o">-</span><span class="nx">alive</span><span class="p">]</span> <span class="nx">Sec</span><span class="o">-</span><span class="nx">Fetch</span><span class="o">-</span><span class="nx">Dest</span><span class="p">:[</span><span class="nx">document</span><span class="p">]</span> <span class="nx">Sec</span><span class="o">-</span><span class="nx">Fetch</span><span class="o">-</span><span class="nx">Mode</span><span class="p">:[</span><span class="nx">navigate</span><span class="p">]</span> <span class="nx">Sec</span><span class="o">-</span><span class="nx">Fetch</span><span class="o">-</span><span class="nx">Site</span><span class="p">:[</span><span class="nx">none</span><span class="p">]</span> <span class="nx">Sec</span><span class="o">-</span><span class="nx">Fetch</span><span class="o">-</span><span class="nx">User</span><span class="p">:[</span><span class="err">?</span><span class="mi">1</span><span class="p">]</span> <span class="nx">Upgrade</span><span class="o">-</span><span class="nx">Insecure</span><span class="o">-</span><span class="nx">Requests</span><span class="p">:[</span><span class="mi">1</span><span class="p">]</span> <span class="nx">User</span><span class="o">-</span><span class="nx">Agent</span><span class="p">:[</span><span class="nx">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="nx">Windows</span> <span class="nx">NT</span> <span class="mf">10.0</span><span class="p">;</span> <span class="nx">Win64</span><span class="p">;</span> <span class="nx">x64</span><span class="p">)</span> <span class="nx">AppleWebKit</span><span class="o">/</span><span class="mf">537.36</span> <span class="p">(</span><span class="nx">KHTML</span><span class="p">,</span> <span class="nx">like</span> <span class="nx">Gecko</span><span class="p">)</span> <span class="nx">Chrome</span><span class="o">/</span><span class="mf">80.0.3987.53</span> <span class="nx">Safari</span><span class="o">/</span><span class="mf">537.36</span> <span class="nx">Edg</span><span class="o">/</span><span class="mf">80.0.361.33</span><span class="p">]]</span>
<span class="nx">r</span><span class="p">.</span><span class="nx">Body</span> <span class="p">=</span>  <span class="p">{}</span>   <span class="c1">//body是空的.使用的是get方法</span>
</pre></div>
</td></tr></table>

<h3 id="http_5">HTTP客户端<a class="headerlink" href="#http_5" title="Permanent link">&para;</a></h3>
<h4 id="1_2">访问百度1:<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//get方式请求一个资源. 两个返回值, resp是 返回的一些信息</span>
    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://www.baidu.com&quot;</span><span class="p">)</span> <span class="c1">//不要忘记加http</span>
    <span class="c1">//resp, err := http.Get(&quot;http://127.0.0.1:8001&quot;)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;http.Get err = &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="k">defer</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span> <span class="c1">//真正读内容是在body这里,最终要记得关闭</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Status = &quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Status</span><span class="p">)</span>   <span class="c1">//状态</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;StatusCode = &quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">)</span>  <span class="c1">//返回的状态码</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Header = &quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Header</span><span class="p">)</span>  <span class="c1">//返回的响应头</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Body = &quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>  <span class="c1">//返回的主体内容</span>

<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>执行:</p>
<p>```go
Status =  200 OK
StatusCode =  200
Header =  map[Bdpagetype:[1] Bdqid:[0xdad5f241000d9727] Cache-Control:[private] Connection:[keep-alive] Content-Type:[text/html] Cxy_all:[baidu+d576bbe330f1b8ecc0886969268b0a17] Date:[Thu, 23 Jan 2020 10:34:11 GMT] Expires:[Thu, 23 Jan 2020 10:34:05 GMT] P3p:[CP=" OTI DSP COR IVA OUR IND COM " CP=" OTI DSP COR IVA OUR IND COM "] Server:[BWS/1.1] Set-Cookie:[BAIDUID=42CA11534A611B58982BD54B7DD37ACD:FG=1; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com BIDUPSID=42CA11534A611B58982BD54B7DD37ACD; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com PSTM=1579775651; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com BAIDUID=42CA11534A611B58447D3493808B52CF:FG=1; max-age=31536000; expires=Fri, 22-Jan-21 10:34:11 GMT; domain=.baidu.com; path=/; version=1; comment=bd delPer=0; path=/; domain=.baidu.com BDSVRTM=0; path=/ BD_HOME=0; path=/ H_PS_PSSID=1428_21083_30494_30473_30502; path=/; domain=.baidu.com] Traceid:[1579775651069814759415768776031295346471] Vary:[Accept-Encoding] X-Ua-Compatible:[IE=Edge,chrome=1]]
Body =  &amp;{0x114741e0 <nil> <nil>} //最后返回的主体内容是个存储的地址,需要进行读取</p>
<p>```</p>
<h4 id="2_2">访问百度2<a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//get方式请求一个资源. 两个返回值, resp是 返回的一些信息</span>
    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://www.baidu.com&quot;</span><span class="p">)</span> <span class="c1">//不要忘记加http</span>
    <span class="c1">//resp, err := http.Get(&quot;http://127.0.0.1:8001&quot;)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;http.Get err = &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="k">defer</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span> <span class="c1">//真正读内容是在body这里,最终要记得关闭</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Status = &quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Status</span><span class="p">)</span>   <span class="c1">//状态</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;StatusCode = &quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">)</span>  <span class="c1">//返回的状态码</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Header = &quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Header</span><span class="p">)</span>  <span class="c1">//返回的响应头</span>
    <span class="c1">//fmt.Println(&quot;Body = &quot;, resp.Body)  //返回的主体内容的地址,需要后面使用Read函数读取内容</span>

    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>   <span class="c1">//定义一个切片用于存储主体的内容</span>
    <span class="kd">var</span> <span class="nx">tmp</span> <span class="kt">string</span>   <span class="c1">//声明一个字符串存储所有的主体内容</span>


    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>  <span class="c1">//使用Read函数就地址中存储的内容读取到切片中</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;read err = &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="p">}</span>
        <span class="nx">tmp</span> <span class="o">+=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span>  <span class="c1">//循环读取主体内容存储到暂存的字符串中</span>
    <span class="p">}</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;tmp = &quot;</span><span class="p">,</span> <span class="nx">tmp</span><span class="p">)</span>

<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>执行结果:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">Status</span> <span class="p">=</span>  <span class="mi">200</span> <span class="nx">OK</span>
<span class="nx">StatusCode</span> <span class="p">=</span>  <span class="mi">200</span>
<span class="nx">Header</span> <span class="p">=</span>  <span class="kd">map</span><span class="p">[</span><span class="nx">Bdpagetype</span><span class="p">:[</span><span class="mi">1</span><span class="p">]</span> <span class="nx">Bdqid</span><span class="p">:[</span><span class="mh">0xdb921da70009060e</span><span class="p">]</span> <span class="nx">Cache</span><span class="o">-</span><span class="nx">Control</span><span class="p">:[</span><span class="nx">private</span><span class="p">]</span> <span class="nx">Connection</span><span class="p">:[</span><span class="nx">keep</span><span class="o">-</span><span class="nx">alive</span><span class="p">]</span> <span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">:[</span><span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">]</span> <span class="nx">Cxy_all</span><span class="p">:[</span><span class="nx">baidu</span><span class="o">+</span><span class="mi">3</span><span class="nx">d718aef6772a8cab64c2ff46e3bfb62</span><span class="p">]</span> <span class="nx">Date</span><span class="p">:[</span><span class="nx">Thu</span><span class="p">,</span> <span class="mi">23</span> <span class="nx">Jan</span> <span class="mi">2020</span> <span class="mi">14</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">47</span> <span class="nx">GMT</span><span class="p">]</span> <span class="nx">Expires</span><span class="p">:[</span><span class="nx">Thu</span><span class="p">,</span> <span class="mi">23</span> <span class="nx">Jan</span> <span class="mi">2020</span> <span class="mi">14</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mo">00</span> <span class="nx">GMT</span><span class="p">]</span> <span class="nx">P3p</span><span class="p">:[</span><span class="nx">CP</span><span class="p">=</span><span class="s">&quot; OTI DSP COR IVA OUR IND COM &quot;</span> <span class="nx">CP</span><span class="p">=</span><span class="s">&quot; OTI DSP COR IVA OUR IND COM &quot;</span><span class="p">]</span> <span class="nx">Server</span><span class="p">:[</span><span class="nx">BWS</span><span class="o">/</span><span class="mf">1.1</span><span class="p">]</span> <span class="nx">Set</span><span class="o">-</span><span class="nx">Cookie</span><span class="p">:[</span><span class="nx">BAIDUID</span><span class="p">=</span><span class="nx">CC6957D506DFEDD0A0F40ACD19AF4C50</span><span class="p">:</span><span class="nx">FG</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">expires</span><span class="p">=</span><span class="nx">Thu</span><span class="p">,</span> <span class="mi">31</span><span class="o">-</span><span class="nx">Dec</span><span class="o">-</span><span class="mi">37</span> <span class="mi">23</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">55</span> <span class="nx">GMT</span><span class="p">;</span> <span class="nx">max</span><span class="o">-</span><span class="nx">age</span><span class="p">=</span><span class="mi">2147483647</span><span class="p">;</span> <span class="nx">path</span><span class="p">=</span><span class="o">/</span><span class="p">;</span> <span class="nx">domain</span><span class="p">=.</span><span class="nx">baidu</span><span class="p">.</span><span class="nx">com</span> <span class="nx">BIDUPSID</span><span class="p">=</span><span class="nx">CC6957D506DFEDD0A0F40ACD19AF4C50</span><span class="p">;</span> <span class="nx">expires</span><span class="p">=</span><span class="nx">Thu</span><span class="p">,</span> <span class="mi">31</span><span class="o">-</span><span class="nx">Dec</span><span class="o">-</span><span class="mi">37</span> <span class="mi">23</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">55</span> <span class="nx">GMT</span><span class="p">;</span> <span class="nx">max</span><span class="o">-</span><span class="nx">age</span><span class="p">=</span><span class="mi">2147483647</span><span class="p">;</span> <span class="nx">path</span><span class="p">=</span><span class="o">/</span><span class="p">;</span> <span class="nx">domain</span><span class="p">=.</span><span class="nx">baidu</span><span class="p">.</span><span class="nx">com</span> <span class="nx">PSTM</span><span class="p">=</span><span class="mi">1579788527</span><span class="p">;</span> <span class="nx">expires</span><span class="p">=</span><span class="nx">Thu</span><span class="p">,</span> <span class="mi">31</span><span class="o">-</span><span class="nx">Dec</span><span class="o">-</span><span class="mi">37</span> <span class="mi">23</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">55</span> <span class="nx">GMT</span><span class="p">;</span> <span class="nx">max</span><span class="o">-</span><span class="nx">age</span><span class="p">=</span><span class="mi">2147483647</span><span class="p">;</span> <span class="nx">path</span><span class="p">=</span><span class="o">/</span><span class="p">;</span> <span class="nx">domain</span><span class="p">=.</span><span class="nx">baidu</span><span class="p">.</span><span class="nx">com</span> <span class="nx">BAIDUID</span><span class="p">=</span><span class="nx">CC6957D506DFEDD0BF2884F290C5C3F3</span><span class="p">:</span><span class="nx">FG</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">max</span><span class="o">-</span><span class="nx">age</span><span class="p">=</span><span class="mi">31536000</span><span class="p">;</span> <span class="nx">expires</span><span class="p">=</span><span class="nx">Fri</span><span class="p">,</span> <span class="mi">22</span><span class="o">-</span><span class="nx">Jan</span><span class="o">-</span><span class="mi">21</span> <span class="mi">14</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">47</span> <span class="nx">GMT</span><span class="p">;</span> <span class="nx">domain</span><span class="p">=.</span><span class="nx">baidu</span><span class="p">.</span><span class="nx">com</span><span class="p">;</span> <span class="nx">path</span><span class="p">=</span><span class="o">/</span><span class="p">;</span> <span class="nx">version</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">comment</span><span class="p">=</span><span class="nx">bd</span> <span class="nx">delPer</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">path</span><span class="p">=</span><span class="o">/</span><span class="p">;</span> <span class="nx">domain</span><span class="p">=.</span><span class="nx">baidu</span><span class="p">.</span><span class="nx">com</span> <span class="nx">BDSVRTM</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">path</span><span class="p">=</span><span class="o">/</span> <span class="nx">BD_HOME</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">path</span><span class="p">=</span><span class="o">/</span> <span class="nx">H_PS_PSSID</span><span class="p">=</span><span class="mi">1441</span><span class="nx">_21092_30495_26350_30503</span><span class="p">;</span> <span class="nx">path</span><span class="p">=</span><span class="o">/</span><span class="p">;</span> <span class="nx">domain</span><span class="p">=.</span><span class="nx">baidu</span><span class="p">.</span><span class="nx">com</span><span class="p">]</span> <span class="nx">Traceid</span><span class="p">:[</span><span class="mi">1579788527054689050615821741044003309070</span><span class="p">]</span> <span class="nx">Vary</span><span class="p">:[</span><span class="nx">Accept</span><span class="o">-</span><span class="nx">Encoding</span><span class="p">]</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Ua</span><span class="o">-</span><span class="nx">Compatible</span><span class="p">:[</span><span class="nx">IE</span><span class="p">=</span><span class="nx">Edge</span><span class="p">,</span><span class="nx">chrome</span><span class="p">=</span><span class="mi">1</span><span class="p">]]</span>
<span class="nx">read</span> <span class="nx">err</span> <span class="p">=</span>  <span class="nx">EOF</span>
<span class="nx">tmp</span> <span class="p">=</span>  <span class="p">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="p">&gt;</span>
<span class="p">&lt;!</span><span class="o">--</span><span class="nx">STATUS</span> <span class="nx">OK</span><span class="o">--</span><span class="p">&gt;</span>



<span class="p">&lt;</span><span class="nx">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nx">head</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="p">=</span><span class="s">&quot;content-type&quot;</span> <span class="nx">content</span><span class="p">=</span><span class="s">&quot;text/html;charset=utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="p">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="nx">content</span><span class="p">=</span><span class="s">&quot;IE=Edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">meta</span> <span class="nx">content</span><span class="p">=</span><span class="s">&quot;always&quot;</span> <span class="nx">name</span><span class="p">=</span><span class="s">&quot;referrer&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="p">=</span><span class="s">&quot;theme-color&quot;</span> <span class="nx">content</span><span class="p">=</span><span class="s">&quot;#2932e1&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;/favicon.ico&quot;</span> <span class="kd">type</span><span class="p">=</span><span class="s">&quot;image/x-icon&quot;</span> <span class="o">/</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;search&quot;</span> <span class="kd">type</span><span class="p">=</span><span class="s">&quot;application/opensearchdescription+xml&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;/content-search.xml&quot;</span> <span class="nx">title</span><span class="p">=</span><span class="s">&quot;百度搜索&quot;</span> <span class="o">/</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;icon&quot;</span> <span class="nx">sizes</span><span class="p">=</span><span class="s">&quot;any&quot;</span> <span class="nx">mask</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;//www.baidu.com/img/baidu_85beaf5496f291521eb75ba38eacbd87.svg&quot;</span><span class="p">&gt;</span>


    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;dns-prefetch&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;//s1.bdstatic.com&quot;</span><span class="o">/</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;dns-prefetch&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;//t1.baidu.com&quot;</span><span class="o">/</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;dns-prefetch&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;//t2.baidu.com&quot;</span><span class="o">/</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;dns-prefetch&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;//t3.baidu.com&quot;</span><span class="o">/</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;dns-prefetch&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;//t10.baidu.com&quot;</span><span class="o">/</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;dns-prefetch&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;//t11.baidu.com&quot;</span><span class="o">/</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;dns-prefetch&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;//t12.baidu.com&quot;</span><span class="o">/</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="p">=</span><span class="s">&quot;dns-prefetch&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;//b1.bdstatic.com&quot;</span><span class="o">/</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nx">title</span><span class="p">&gt;</span><span class="nx">百度一下</span><span class="err">，</span><span class="nx">你就知道</span><span class="p">&lt;</span><span class="o">/</span><span class="nx">title</span><span class="p">&gt;</span>


<span class="p">&lt;</span><span class="nx">style</span> <span class="nx">id</span><span class="p">=</span><span class="s">&quot;css_index&quot;</span> <span class="nx">index</span><span class="p">=</span><span class="s">&quot;index&quot;</span> <span class="kd">type</span><span class="p">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span><span class="nx">html</span><span class="p">,</span><span class="nx">body</span><span class="p">{</span><span class="nx">height</span><span class="p">:</span><span class="mi">100</span><span class="o">%</span><span class="p">}</span>
<span class="nx">html</span><span class="p">{</span><span class="nx">overflow</span><span class="o">-</span><span class="nx">y</span><span class="p">:</span><span class="nx">auto</span><span class="p">}</span>
<span class="nx">body</span><span class="p">{</span><span class="nx">font</span><span class="p">:</span><span class="mi">12</span><span class="nx">px</span> <span class="nx">arial</span><span class="p">;</span><span class="nx">text</span><span class="o">-</span><span class="nx">align</span><span class="p">:;</span><span class="nx">background</span><span class="p">:</span><span class="err">#</span><span class="nx">fff</span><span class="p">}</span>
<span class="nx">body</span><span class="p">,</span><span class="nx">p</span><span class="p">,</span><span class="nx">form</span><span class="p">,</span><span class="nx">ul</span><span class="p">,</span><span class="nx">li</span><span class="p">{</span><span class="nx">margin</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="nx">padding</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="nx">list</span><span class="o">-</span><span class="nx">style</span><span class="p">:</span><span class="nx">none</span><span class="p">}</span>
<span class="nx">body</span><span class="p">,</span><span class="nx">form</span><span class="p">,</span><span class="err">#</span><span class="nx">fm</span><span class="p">{</span><span class="nx">position</span><span class="p">:</span><span class="nx">relative</span><span class="p">}</span>
<span class="nx">td</span><span class="p">{</span><span class="nx">text</span><span class="o">-</span><span class="nx">align</span><span class="p">:</span><span class="nx">left</span><span class="p">}</span>
<span class="nx">img</span><span class="p">{</span><span class="nx">border</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
<span class="nx">a</span><span class="p">{</span><span class="nx">color</span><span class="p">:</span><span class="err">#</span><span class="mo">00</span><span class="nx">c</span><span class="p">}</span>
<span class="nx">a</span><span class="p">:</span><span class="nx">active</span><span class="p">{</span><span class="nx">color</span><span class="p">:</span><span class="err">#</span><span class="nx">f60</span><span class="p">}</span>
<span class="nx">input</span><span class="p">{</span><span class="nx">border</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="nx">padding</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
<span class="o">...............................................................................................................</span><span class="p">.</span>
</pre></div>
</td></tr></table>

<p>#### 访问 127.0.0.1:8001</p>
<p>开启前面写的 HTTP服务端</p>
<p><img alt="image-20200123221618310" src="../039 go语言网络编程_Http编程.image/image-20200123221618310.png" /></p>
<p>修改 客户端访问的代码</p>
<p><img alt="image-20200123221543677" src="../039 go语言网络编程_Http编程.image/image-20200123221543677.png" /></p>
<p>访问结果:客户端</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">Status</span> <span class="p">=</span>  <span class="mi">200</span> <span class="nx">OK</span>
<span class="nx">StatusCode</span> <span class="p">=</span>  <span class="mi">200</span>
<span class="nx">Header</span> <span class="p">=</span>  <span class="kd">map</span><span class="p">[</span><span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="p">:[</span><span class="mi">8</span><span class="p">]</span> <span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">:[</span><span class="nx">text</span><span class="o">/</span><span class="nx">plain</span><span class="p">;</span> <span class="nx">charset</span><span class="p">=</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span> <span class="nx">Date</span><span class="p">:[</span><span class="nx">Thu</span><span class="p">,</span> <span class="mi">23</span> <span class="nx">Jan</span> <span class="mi">2020</span> <span class="mi">14</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mo">01</span> <span class="nx">GMT</span><span class="p">]]</span>
<span class="nx">read</span> <span class="nx">err</span> <span class="p">=</span>  <span class="nx">EOF</span>
<span class="nx">tmp</span> <span class="p">=</span>  <span class="nx">hello</span> <span class="k">go</span>   <span class="c1">//主体的内容</span>
</pre></div>
</td></tr></table>

<p>服务端打印的结果</p>
<p><img alt="image-20200123221752778" src="../039 go语言网络编程_Http编程.image/image-20200123221752778.png" /></p>
<h2 id="_5">百度贴吧爬虫<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p><strong>实际上爬虫一共就四个主要步骤：</strong></p>
<ol>
<li>明确目标 (要知道你准备在哪个范围或者网站去搜索)</li>
<li>爬 (将所有的网站的内容全部爬下来)</li>
<li>取 (去掉对我们没用处的数据)</li>
<li>处理数据（按照我们想要的方式存储和使用）</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">百度贴吧</span> <span class="nx">网页规律</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=0  //下一页+50</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=50</span>
<span class="nx">http</span><span class="p">:</span><span class="c1">//tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=100</span>
</pre></div>
</td></tr></table>

<p>代码</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;strconv&quot;</span>
<span class="p">)</span>

<span class="c1">//爬取网页内容</span>
<span class="kd">func</span> <span class="nx">HttpGet</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">result</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err1</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>  <span class="c1">//get方法获取内容</span>
    <span class="k">if</span> <span class="nx">err1</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">err</span> <span class="p">=</span> <span class="nx">err1</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="k">defer</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="c1">//读取网页body内容</span>
    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span> <span class="c1">//读取结束，或者，出问题</span>
            <span class="c1">//fmt.Println(&quot;resp.Body.Read err = &quot;, err)</span>
            <span class="k">break</span>
        <span class="p">}</span>

        <span class="nx">result</span> <span class="o">+=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span>
    <span class="p">}</span>

    <span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">DoWork</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;正在爬取 %d 到 %d 的页面\n&quot;</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span>

    <span class="c1">//明确目标 (要知道你准备在哪个范围或者网站去搜索)</span>
    <span class="c1">//http://tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=0  //下一页+50</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">start</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">end</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">:=</span> <span class="s">&quot;http://tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=&quot;</span> <span class="o">+</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">((</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>  <span class="c1">//strconv.Itoa   整型转换成字符串</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;url = &quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>

        <span class="c1">//2) 爬 (将所有的网站的内容全部爬下来)</span>
        <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">HttpGet</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="c1">//使用HttpGet自定义的函数 获取内容</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;HttpGet err = &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="p">}</span>

        <span class="c1">//把内容写入到文件</span>
        <span class="nx">fileName</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.html&quot;</span>   <span class="c1">//爬取出的是html格式的文件</span>
        <span class="nx">f</span><span class="p">,</span> <span class="nx">err1</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">fileName</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err1</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;os.Create err1 = &quot;</span><span class="p">,</span> <span class="nx">err1</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="p">}</span>

        <span class="nx">f</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="c1">//写内容</span>

        <span class="nx">f</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span> <span class="c1">//关闭文件</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span> <span class="kt">int</span>   <span class="c1">//先声明再获取值</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;请输入起始页( &gt;= 1) :&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">start</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;请输入终止页( &gt;= 起始页) :&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">end</span><span class="p">)</span>

    <span class="nx">DoWork</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span>   <span class="c1">//获取起止页的数据</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>执行结果:</p>
<p><img alt="image-20200124081556542" src="../039 go语言网络编程_Http编程.image/image-20200124081556542.png" /></p>
<p><img alt="image-20200124081621301" src="../039 go语言网络编程_Http编程.image/image-20200124081621301.png" /></p>
<h2 id="_6">并发百度贴吧网络爬虫<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>使用协程开启所有的爬虫任务</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;strconv&quot;</span>
<span class="p">)</span>

<span class="c1">//爬取网页内容</span>
<span class="kd">func</span> <span class="nx">HttpGet</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">result</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err1</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err1</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">err</span> <span class="p">=</span> <span class="nx">err1</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="k">defer</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="c1">//读取网页body内容</span>
    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span> <span class="c1">//读取结束，或者，出问题</span>
            <span class="c1">//fmt.Println(&quot;resp.Body.Read err = &quot;, err)</span>
            <span class="k">break</span>
        <span class="p">}</span>

        <span class="nx">result</span> <span class="o">+=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span>
    <span class="p">}</span>

    <span class="k">return</span>
<span class="p">}</span>

<span class="c1">//爬取一个网页</span>
<span class="kd">func</span> <span class="nx">SpiderPape</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">page</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">url</span> <span class="o">:=</span> <span class="s">&quot;http://tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=&quot;</span> <span class="o">+</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">((</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;正在爬第%d页网页: %s\n&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>

    <span class="c1">//2) 爬 (将所有的网站的内容全部爬下来)</span>
    <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">HttpGet</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;HttpGet err = &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">//把内容写入到文件</span>
    <span class="nx">fileName</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.html&quot;</span>
    <span class="nx">f</span><span class="p">,</span> <span class="nx">err1</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">fileName</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err1</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;os.Create err1 = &quot;</span><span class="p">,</span> <span class="nx">err1</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">f</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="c1">//写内容</span>

    <span class="nx">f</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span> <span class="c1">//关闭文件</span>

    <span class="nx">page</span> <span class="o">&lt;-</span> <span class="nx">i</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">DoWork</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;正在爬取 %d 到 %d 的页面\n&quot;</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span>
    <span class="nx">page</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>    <span class="c1">//用来检测哪一页被爬取完毕了</span>

    <span class="c1">//明确目标 (要知道你准备在哪个范围或者网站去搜索)</span>
    <span class="c1">//http://tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=0  //下一页+50</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">start</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">end</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="nx">SpiderPape</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">page</span><span class="p">)</span>   <span class="c1">//循环开启所有的爬虫内务</span>
    <span class="p">}</span>

    <span class="c1">//这个循环的作用就是检测所有的爬虫任务,并且防止主协程关闭</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">start</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">end</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;第%d个页面爬取完成\n&quot;</span><span class="p">,</span> <span class="o">&lt;-</span><span class="nx">page</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span> <span class="kt">int</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;请输入起始页( &gt;= 1) :&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">start</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;请输入终止页( &gt;= 起始页) :&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">end</span><span class="p">)</span>

    <span class="nx">DoWork</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>执行结果</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">请输入起始页</span><span class="p">(</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span><span class="mi">1</span>
<span class="nx">请输入终止页</span><span class="p">(</span> <span class="o">&gt;=</span> <span class="nx">起始页</span><span class="p">)</span> <span class="p">:</span><span class="mi">5</span>
<span class="nx">正在爬取</span> <span class="mi">1</span> <span class="nx">到</span> <span class="mi">5</span> <span class="nx">的页面</span>
<span class="nx">正在爬第5页网页</span><span class="p">:</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=200</span>
<span class="nx">正在爬第2页网页</span><span class="p">:</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=50</span>
<span class="nx">正在爬第1页网页</span><span class="p">:</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=0</span>
<span class="nx">正在爬第4页网页</span><span class="p">:</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=150</span>
<span class="nx">正在爬第3页网页</span><span class="p">:</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//tieba.baidu.com/f?kw=%E7%BB%9D%E5%9C%B0%E6%B1%82%E7%94%9F&amp;ie=utf-8&amp;pn=100</span>
<span class="nx">第2个页面爬取完成</span>
<span class="nx">第4个页面爬取完成</span>
<span class="nx">第5个页面爬取完成</span>
<span class="nx">第3个页面爬取完成</span>
<span class="nx">第1个页面爬取完成</span>

<span class="nx">Process</span> <span class="nx">finished</span> <span class="nx">with</span> <span class="nx">exit</span> <span class="nx">code</span> <span class="mi">0</span>
</pre></div>
</td></tr></table>

<h2 id="_7">段子爬虫<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nx">网页规律</span><span class="err">：</span>
<span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/xiaohua_1.html   下一页 +1</span>
<span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/xiaohua_2.html</span>

<span class="nx">主页面规律</span><span class="err">：</span>
<span class="p">&lt;</span><span class="nx">h1</span> <span class="nx">class</span><span class="p">=</span><span class="s">&quot;dp-b&quot;</span><span class="p">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot; 一个段子url连接   &quot;</span>

<span class="p">[[&lt;</span><span class="nx">h1</span> <span class="nx">class</span><span class="p">=</span><span class="s">&quot;dp-b&quot;</span><span class="p">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;https://www.pengfu.com/content_1788974_1.html&quot;</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788974_1.html] </span>

<span class="p">[&lt;</span><span class="nx">h1</span> <span class="nx">class</span><span class="p">=</span><span class="s">&quot;dp-b&quot;</span><span class="p">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;https://www.pengfu.com/content_1788973_1.html&quot;</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788973_1.html] </span>

<span class="p">[&lt;</span><span class="nx">h1</span> <span class="nx">class</span><span class="p">=</span><span class="s">&quot;dp-b&quot;</span><span class="p">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;https://www.pengfu.com/content_1788972_1.html&quot;</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788972_1.html] </span>

<span class="p">[&lt;</span><span class="nx">h1</span> <span class="nx">class</span><span class="p">=</span><span class="s">&quot;dp-b&quot;</span><span class="p">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="p">=</span><span class="s">&quot;https://www.pengfu.com/content_1788971_1.html&quot;</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788971_1.html] [&lt;h1 class=&quot;dp-b&quot;&gt;&lt;a href=&quot;https://www.pengfu.com/content_1788970_1.html&quot; https://www.pengfu.com/content_1788970_1.html] [&lt;h1 class=&quot;dp-b&quot;&gt;&lt;a href=&quot;https://www.pengfu.com/content_1788969_1.html&quot; https://www.pengfu.com/content_1788969_1.html] [&lt;h1 class=&quot;dp-b&quot;&gt;&lt;a href=&quot;https://www.pengfu.com/content_1788968_1.html&quot; https://www.pengfu.com/content_1788968_1.html] [&lt;h1 class=&quot;dp-b&quot;&gt;&lt;a href=&quot;https://www.pengfu.com/content_1788967_1.html&quot; https://www.pengfu.com/content_1788967_1.html] [&lt;h1 class=&quot;dp-b&quot;&gt;&lt;a href=&quot;https://www.pengfu.com/content_1788966_1.html&quot; https://www.pengfu.com/content_1788966_1.html] [&lt;h1 class=&quot;dp-b&quot;&gt;&lt;a href=&quot;https://www.pengfu.com/content_1788965_1.html&quot; https://www.pengfu.com/content_1788965_1.html]]</span>


<span class="nx">url</span> <span class="p">=</span>  <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788974_1.html</span>
<span class="nx">url</span> <span class="p">=</span>  <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788973_1.html</span>
<span class="nx">url</span> <span class="p">=</span>  <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788972_1.html</span>
<span class="nx">url</span> <span class="p">=</span>  <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788971_1.html</span>
<span class="nx">url</span> <span class="p">=</span>  <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788970_1.html</span>
<span class="nx">url</span> <span class="p">=</span>  <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788969_1.html</span>
<span class="nx">url</span> <span class="p">=</span>  <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788968_1.html</span>
<span class="nx">url</span> <span class="p">=</span>  <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788967_1.html</span>
<span class="nx">url</span> <span class="p">=</span>  <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788966_1.html</span>
<span class="nx">url</span> <span class="p">=</span>  <span class="nx">https</span><span class="p">:</span><span class="c1">//www.pengfu.com/content_1788965_1.html</span>



<span class="nx">段子url</span><span class="p">:</span>
<span class="p">&lt;</span><span class="nx">h1</span><span class="p">&gt;</span>  <span class="nx">标题</span> <span class="p">&lt;</span><span class="o">/</span><span class="nx">h1</span><span class="p">&gt;</span>  <span class="nx">只取1个</span>
<span class="p">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="p">=</span><span class="s">&quot;content-txt pt10&quot;</span><span class="p">&gt;</span> <span class="nx">段子内容</span> <span class="p">&lt;</span><span class="nx">a</span> <span class="nx">id</span><span class="p">=</span><span class="s">&quot;prev&quot;</span> <span class="nx">href</span><span class="p">=</span><span class="err">&quot;</span>


 <span class="err">#</span>
<span class="nx">大四的时候出来实习</span><span class="err">，</span><span class="nx">刚进社会嘛</span><span class="err">，</span><span class="nx">辈份小</span><span class="err">，</span><span class="nx">嘴巴甜一点是必须</span><span class="err">，</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">所以每天到了办公室</span><span class="err">，</span><span class="nx">各种叔叔阿姨很热情地叫</span><span class="err">，</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">有一天我在饭堂吃饭</span><span class="err">，</span><span class="nx">恰好听到附近几个办公室的女人在聊天</span><span class="err">，</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="err">“</span><span class="nx">刚来实习的那个小伙子</span><span class="err">，</span><span class="nx">各方面还可以</span><span class="err">，</span><span class="nx">就是那个嘴特毒</span><span class="err">！！！”#</span><span class="nx">content</span> <span class="p">=</span> <span class="err">#</span>
<span class="err">“</span><span class="nx">我在家的地位提升了</span><span class="err">”</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="err">“</span><span class="nx">怎么</span><span class="err">，</span><span class="nx">你老婆不打你了</span><span class="err">？”</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="err">“</span><span class="nx">不是</span><span class="err">，</span><span class="nx">我家的狗死了</span><span class="err">”</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="err">“……”#</span><span class="nx">content</span> <span class="p">=</span> <span class="err">#</span>
<span class="nx">一日</span><span class="err">，</span><span class="nx">老师在讲课</span><span class="err">。</span><span class="nx">老师说</span><span class="err">：“</span><span class="nx">吕在古代是接吻的意思</span><span class="err">，</span><span class="nx">上面一个口下面一个口</span><span class="err">。”</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">一位童鞋接着问</span><span class="err">：“</span><span class="nx">那品怎么解释</span><span class="err">？”</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">老师正要发火</span><span class="err">。</span><span class="nx">又有一个童鞋说</span><span class="err">：“</span><span class="nx">那么器呢</span><span class="err">，</span><span class="nx">四个人围着一条狗在干什么</span><span class="err">？”#</span><span class="nx">content</span> <span class="p">=</span> <span class="err">#</span>
<span class="nx">甲</span><span class="err">：</span><span class="nx">你知道吗</span><span class="err">？</span><span class="nx">我正在培育新品种</span><span class="err">，</span><span class="nx">让鸽子与鹦鹉杂交</span><span class="err">。</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">乙</span><span class="err">：</span><span class="nx">为什么</span><span class="err">？</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">甲</span><span class="err">：</span><span class="nx">如果鸽子迷了路</span><span class="err">，</span><span class="nx">那它就可以自己问路了</span><span class="err">。#</span><span class="nx">content</span> <span class="p">=</span> <span class="err">#</span>
<span class="nx">体育课</span><span class="err">，</span><span class="nx">懒得跑步</span><span class="err">。</span><span class="nx">一个人溜回寝室后</span><span class="err">，</span><span class="nx">发现静悄悄的突然想干点邪恶的事</span><span class="err">。</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">于是熟练的打开电脑</span><span class="err">→</span><span class="nx">D盘</span><span class="err">→</span><span class="nx">成人收藏</span><span class="err">→</span><span class="nx">XXOO高清无马</span><span class="p">.</span><span class="nx">rmvb</span><span class="err">。</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">然后开始收拾小弟弟</span><span class="err">。。。。</span><span class="nx">待小弟弟</span><span class="err">“</span><span class="nx">吐了</span><span class="err">”</span><span class="nx">之后提裤收拾的时候猛然发现寝室老二的女朋友在其床上玩手机</span><span class="err">！</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">fuck</span><span class="err">！！！</span><span class="nx">在寝室死一般的沉默许久之后</span><span class="err">。</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">此女憋了半天打破尴尬来了句</span><span class="err">：“</span><span class="nx">你不去洗洗吗</span><span class="err">？</span><span class="nx">这样不健康</span><span class="err">。”#</span><span class="nx">content</span> <span class="p">=</span> <span class="err">#</span>
<span class="nx">想你</span><span class="err">，</span><span class="nx">不知道分手这么久你过得怎么样</span><span class="err">，</span><span class="nx">有没有人像我一样爱你</span><span class="err">。</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">你总是长不大</span><span class="err">，</span><span class="nx">需要别人照顾</span><span class="err">，</span><span class="nx">就连过马路也会忘记看红绿灯</span><span class="err">，</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">一定要别人牵着你才安全</span><span class="err">。</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">其实没什么重要得事</span><span class="err">，</span><span class="nx">就是想告诉你我考下驾照了</span><span class="err">，</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">以后出门注意点</span><span class="err">。#</span><span class="nx">content</span> <span class="p">=</span> <span class="err">#</span>
<span class="nx">刚才去银行取钱</span><span class="err">，</span><span class="nx">经理居然把我赶出来了</span><span class="err">！</span><span class="nx">操</span><span class="err">，</span><span class="nx">这算是什么服务态度啊</span><span class="err">，</span><span class="nx">幸好我从没在这家银行存过钱</span><span class="err">！#</span><span class="nx">content</span> <span class="p">=</span> <span class="err">#</span>
<span class="nx">昨天活捉了一只花蚊子</span><span class="err">，</span><span class="nx">可能是因为天气太热了</span><span class="err">，</span><span class="nx">顿生怜悯之意</span><span class="err">，</span><span class="nx">想了半天就把蚊子放生到室友的蚊帐里了</span><span class="err">。#</span><span class="nx">content</span> <span class="p">=</span> <span class="err">#</span>
<span class="nx">情人节终于约到炮了</span><span class="err">！</span><span class="nx">进了宾馆房间</span><span class="err">，</span><span class="nx">妹子看着我说</span><span class="err">：“</span><span class="nx">我有点儿害怕</span><span class="err">，</span><span class="nx">做的时候你一定要带套哦</span><span class="err">。”</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">我掏出安全套说</span><span class="err">：“</span><span class="nx">别怕</span><span class="err">，</span><span class="nx">我都准备好了</span><span class="err">。”</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">妹子说</span><span class="err">：“</span><span class="nx">不是</span><span class="err">，</span><span class="nx">我是说你要戴上头套</span><span class="err">，</span><span class="nx">你长得太丑了</span><span class="err">，</span><span class="nx">看着害怕</span><span class="err">。”#</span><span class="nx">content</span> <span class="p">=</span> <span class="err">#</span>
<span class="nx">今天大街上看到一男的打女的</span><span class="err">，</span><span class="nx">男的骂道</span><span class="err">：“</span><span class="nx">TMD这么漂亮不好好找人嫁了</span><span class="err">，</span><span class="nx">去当小三</span><span class="err">。”</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">路人</span><span class="err">：“</span><span class="nx">大哥</span><span class="err">，</span><span class="nx">媳妇不可以这样打啊</span><span class="err">。”</span><span class="p">&lt;</span><span class="nx">br</span> <span class="o">/</span><span class="p">&gt;</span>
<span class="nx">大哥狠狠的看了路人一眼</span><span class="err">：“</span><span class="nx">她勾引我媳妇</span><span class="err">。”#</span>
</pre></div>
</td></tr></table>

<p>代码</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;regexp&quot;</span>
    <span class="s">&quot;strconv&quot;</span>
    <span class="s">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">HttpGet</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">result</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err1</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="c1">//发送get请求</span>
    <span class="k">if</span> <span class="nx">err1</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">err</span> <span class="p">=</span> <span class="nx">err1</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="k">defer</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="c1">//读取网页内容</span>
    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="k">break</span>
        <span class="p">}</span>

        <span class="nx">result</span> <span class="o">+=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span> <span class="c1">//累加读取的内容</span>
    <span class="p">}</span>

    <span class="k">return</span>
<span class="p">}</span>

<span class="c1">//开始爬取每一个笑话，每一个段子 title, content, err := SpiderOneJoy(url)</span>
<span class="kd">func</span> <span class="nx">SpiderOneJoy</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">content</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//开始爬取页面内容</span>
    <span class="nx">result</span><span class="p">,</span> <span class="nx">err1</span> <span class="o">:=</span> <span class="nx">HttpGet</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err1</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="c1">//fmt.Println(&quot;HttpGet err = &quot;, err)</span>
        <span class="nx">err</span> <span class="p">=</span> <span class="nx">err1</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">//取关键信息</span>
    <span class="c1">//取标题  &lt;h1&gt;  标题 &lt;/h1&gt;  只取1个</span>
    <span class="nx">re1</span> <span class="o">:=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`&lt;h1&gt;(?s:(.*?))&lt;/h1&gt;`</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">re1</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="c1">//fmt.Println(&quot;regexp.MustCompile err&quot;)</span>
        <span class="nx">err</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="s">&quot;regexp.MustCompile err&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="c1">//取内容</span>
    <span class="nx">tmpTitle</span> <span class="o">:=</span> <span class="nx">re1</span><span class="p">.</span><span class="nx">FindAllStringSubmatch</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//最后一个参数为1，只过滤第一个</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">data</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tmpTitle</span> <span class="p">{</span>
        <span class="nx">title</span> <span class="p">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">//      title = strings.Replace(title, &quot;\r&quot;, &quot;&quot;, -1)</span>
        <span class="c1">//      title = strings.Replace(title, &quot;\n&quot;, &quot;&quot;, -1)</span>
        <span class="c1">//      title = strings.Replace(title, &quot; &quot;, &quot;&quot;, -1)</span>
        <span class="nx">title</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="s">&quot;\t&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="p">}</span>

    <span class="c1">//取内容 &lt;div class=&quot;content-txt pt10&quot;&gt; 段子内容 &lt;a id=&quot;prev&quot; href=&quot;</span>
    <span class="nx">re2</span> <span class="o">:=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`&lt;div class=&quot;content-txt pt10&quot;&gt;(?s:(.*?))&lt;a id=&quot;prev&quot; href=&quot;`</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">re2</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="c1">//fmt.Println(&quot;regexp.MustCompile err&quot;)</span>
        <span class="nx">err</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="s">&quot;regexp.MustCompile err2&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">//取内容</span>
    <span class="nx">tmpContent</span> <span class="o">:=</span> <span class="nx">re2</span><span class="p">.</span><span class="nx">FindAllStringSubmatch</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">data</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tmpContent</span> <span class="p">{</span>
        <span class="nx">content</span> <span class="p">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="nx">content</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s">&quot;\t&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="nx">content</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="nx">content</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s">&quot;\r&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="nx">content</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="s">&quot;&lt;br /&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="p">}</span>

    <span class="k">return</span>
<span class="p">}</span>

<span class="c1">//把内容写入到文件</span>
<span class="kd">func</span> <span class="nx">StoreJoyToFile</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">fileTitle</span><span class="p">,</span> <span class="nx">fileContent</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//新建文件</span>
    <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.txt&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;os.Create err = &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="k">defer</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="c1">//写内容</span>
    <span class="nx">n</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">fileTitle</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="c1">//写标题</span>
        <span class="nx">f</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">fileTitle</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
        <span class="c1">//写内容</span>
        <span class="nx">f</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">fileContent</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>

        <span class="nx">f</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;\n=================================================================\n&quot;</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">func</span> <span class="nx">SpiderPape</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">page</span> <span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//明确爬取的url</span>
    <span class="c1">//https://www.pengfu.com/xiaohua_1.html</span>
    <span class="nx">url</span> <span class="o">:=</span> <span class="s">&quot;https://www.pengfu.com/xiaohua_&quot;</span> <span class="o">+</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.html&quot;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;正在爬取第%d个网页：%s\n&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>

    <span class="c1">//开始爬取页面内容</span>
    <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">HttpGet</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;HttpGet err = &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">//fmt.Println(&quot;r = &quot;, result)</span>
    <span class="c1">//取，&lt;h1 class=&quot;dp-b&quot;&gt;&lt;a href=&quot; 一个段子url连接   &quot;</span>
    <span class="c1">//解释表达式</span>
    <span class="nx">re</span> <span class="o">:=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`&lt;h1 class=&quot;dp-b&quot;&gt;&lt;a href=&quot;(?s:(.*?))&quot;`</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">re</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;regexp.MustCompile err&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">//取关键信息</span>
    <span class="nx">joyUrls</span> <span class="o">:=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">FindAllStringSubmatch</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">//fmt.Println(&quot;joyUrls = &quot;, joyUrls)</span>

    <span class="nx">fileTitle</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">fileContent</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1">//取网址</span>
    <span class="c1">//第一个返回下标，第二个返回内容</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">data</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">joyUrls</span> <span class="p">{</span>
        <span class="c1">//fmt.Println(&quot;url = &quot;, data[1])</span>

        <span class="c1">//开始爬取每一个笑话，每一个段子</span>
        <span class="nx">title</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">SpiderOneJoy</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;SpiderOneJoy err = &quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="p">}</span>
        <span class="c1">//fmt.Printf(&quot;title = #%v#&quot;, title)</span>
        <span class="c1">//fmt.Printf(&quot;content = #%v#&quot;, content)</span>

        <span class="nx">fileTitle</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">fileTitle</span><span class="p">,</span> <span class="nx">title</span><span class="p">)</span>       <span class="c1">//追加内容</span>
        <span class="nx">fileContent</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">fileContent</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="c1">//追加内容</span>
    <span class="p">}</span>

    <span class="c1">//fmt.Println(&quot;fileTitle= &quot;, fileTitle)</span>
    <span class="c1">//fmt.Println(&quot;fileContent= &quot;, fileContent)</span>

    <span class="c1">//把内容写入到文件</span>
    <span class="nx">StoreJoyToFile</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">fileTitle</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">)</span>

    <span class="nx">page</span> <span class="o">&lt;-</span> <span class="nx">i</span> <span class="c1">//写内容，写num</span>

<span class="p">}</span>

<span class="kd">func</span> <span class="nx">DoWork</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;准备爬取第%d页到%d页的网址\n&quot;</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span>

    <span class="nx">page</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">start</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">end</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="c1">//定义一个函数，爬主页面</span>
        <span class="k">go</span> <span class="nx">SpiderPape</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">page</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">start</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">end</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;第%d个页面爬取完成\n&quot;</span><span class="p">,</span> <span class="o">&lt;-</span><span class="nx">page</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span> <span class="kt">int</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;请输入起始页( &gt;= 1) :&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">start</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;请输入终止页( &gt;= 起始页) :&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">end</span><span class="p">)</span>

    <span class="nx">DoWork</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="c1">//工作函数</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../038 go语言网络编程_Socket编程/" title="Socket编程" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                Socket编程
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        <!-- powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a> -->
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>